<!--
  Purpose: Protected page where logged-in users can upload CSV files.
  - Verifies login using localStorage.
  - Provides drag-and-drop and file browser upload.
  - Allows logout, which clears login state.
-->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Upload CSV</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="h-screen w-screen bg-gradient-to-br from-gray-800 to-black flex justify-center items-center">

  <div class="bg-white/10 backdrop-blur-md rounded-3xl p-10 w-full max-w-3xl text-center">
    <!-- Top bar: user info + logout -->
    <div class="flex justify-between items-center mb-4">
      <p class="text-sm text-white">
        Logged in as: <span id="loggedInUser" class="font-semibold">User</span>
      </p>
      <button id="logoutBtn"
        class="bg-red-600 hover:bg-red-700 text-white font-semibold py-2 px-6 rounded-full">
        Logout
      </button>
    </div>

    <h2 class="text-2xl font-bold text-white mb-6">Upload CSV File</h2>

    <!-- Drag & Drop upload area -->
    <div id="dropZone"
      class="bg-white/20 border-2 border-dashed border-white/50 rounded-xl p-10 text-white mb-4 cursor-pointer"
    >
      <svg class="w-16 h-16 mb-4 mx-auto" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round"
          d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1M4 12l4-4m0 0l4 4m-4-4v12" />
      </svg>
      <p class="text-lg font-medium">Drag and Drop your CSV Files here</p>
      <p class="text-md">or Click To Browse</p>
      <input type="file" id="fileInput" accept=".csv" class="hidden" />
    </div>

    <!-- Browse button -->
    <button id="browseBtn"
      class="bg-gradient-to-r from-gray-700 to-black py-3 px-9 text-white rounded-full mb-4">
      Browse Files
    </button>

    <!-- Upload progress/status -->
    <div id="uploadStatus" class="text-white mt-4"></div>
  </div>

  <script>
    // Login Protection
    const loggedInUser = localStorage.getItem("loggedInUser");
    if (!loggedInUser) {
      alert("You must log in first!");
      window.location.href = "login.html";
    } else {
      document.getElementById("loggedInUser").textContent = loggedInUser;
    }

    // Logout
    document.getElementById("logoutBtn").addEventListener("click", () => {
      localStorage.removeItem("loggedInUser");
      window.location.href = "index.html";
    });

    // Upload simulation
    const fileInput = document.getElementById("fileInput");
    const dropZone = document.getElementById("dropZone");
    const browseBtn = document.getElementById("browseBtn");
    const uploadStatus = document.getElementById("uploadStatus");

    let uploadProgress = 0;

    function simulateUpload(fileName) {
      uploadStatus.innerHTML = `
        <p>Uploading <strong>${fileName}</strong>...</p>
        <div class="w-full bg-white/20 h-2 rounded-full mt-1">
          <div id="progressBar" class="bg-white h-2 rounded-full" style="width: 0%"></div>
        </div>
        <p id="progressText" class="text-right mt-1 text-sm">0%</p>
      `;

      uploadProgress = 0;
      const interval = setInterval(() => {
        uploadProgress += 5;
        document.getElementById("progressBar").style.width = `${uploadProgress}%`;
        document.getElementById("progressText").textContent = `${uploadProgress}%`;

        if (uploadProgress >= 100) {
          clearInterval(interval);
          uploadStatus.innerHTML = `
            <div class="text-green-400 font-semibold mt-2 text-left">
              <strong>${fileName}</strong> uploaded successfully!
            </div>
          `;
        }
      }, 200);
    }

    // Event listeners for upload area
    dropZone.addEventListener("click", () => fileInput.click());
    dropZone.addEventListener("dragover", (e) => e.preventDefault());
    dropZone.addEventListener("drop", (e) => {
      e.preventDefault();
      const file = e.dataTransfer.files[0];
      if (file) simulateUpload(file.name);
    });

    browseBtn.addEventListener("click", () => fileInput.click());
    fileInput.addEventListener("change", (e) => {
      const file = e.target.files[0];
      if (file) simulateUpload(file.name);
    });
  </script>
</body>
</html>
